<?xml version="1.0" encoding="UTF-8"?>

<UTQLPatternTemplates xmlns='http://ar.in.tum.de/ubitrack/utql'
                      xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
                      xmlns:xi='http://www.w3.org/2001/XInclude'
                      xmlns:h="http://www.w3.org/1999/xhtml"
                      xsi:schemaLocation='http://ar.in.tum.de/ubitrack/utql ../../../schema/utql_templates.xsd'>
    
    <Pattern name="SpaceNavigator" displayName="SpaceNavigator 3D Mouse">
        <Description><h:p>This component provides accumulated pose measurements from a Connexion SpaceNavigator 3D input device. The initial pose is the identity transform.
                This component might be used for example to steer a virtual camera in the world coordinate system.
        </h:p></Description>
        <Output>
            <Node name="SpaceNavigator" displayName="Navigation Pose"/>
            <Node name="World" displayName="World"/>
            <Node name="Button" displayName="Button"/>
            
            <Edge name="Movement" source="SpaceNavigator" destination="World" displayName="Movement">
                <Description><h:p>Accumulated navigation pose in the initial SpaceNavigator coordinate system.</h:p></Description>
                <Attribute name="type" value="6D" xsi:type="EnumAttributeReferenceType"/>
		<Attribute name="mode" value="push" xsi:type="EnumAttributeReferenceType"/>
            </Edge>
            <Edge name="Button" source="Button" destination="World" displayName="Button">
                <Description><h:p>Pushes signal events, associated with left button of SpaceNavigatorDevice</h:p></Description>
                <Attribute name="type" value="Button" xsi:type="EnumAttributeReferenceType"/>
                <Attribute name="mode" value="push" xsi:type="EnumAttributeReferenceType"/>
            </Edge>
        </Output>
        
        <DataflowConfiguration>
            <UbitrackLib class="SpaceNavigator"/>
            <Attribute name="position" xsi:type="DoubleArrayAttributeReferenceType"/>
            <Attribute name="rotation" xsi:type="DoubleArrayAttributeReferenceType"/>
            <Attribute name="posThreshold" displayName="Position threshold" min="0" max="400" default="50" xsi:type="IntAttributeDeclarationType">
                <Description><p xmlns="http://www.w3.org/1999/xhtml">Threshold in SpaceNavigator translation units above which movement becomes effective</p></Description>
            </Attribute>
            <Attribute name="rotThreshold" displayName="Orientation threshold" min="0" max="400" default="50" xsi:type="IntAttributeDeclarationType">
                <Description><p xmlns="http://www.w3.org/1999/xhtml">Threshold in SpaceNavigator rotation units above which movement becomes effective</p></Description>
            </Attribute>
            <Attribute name="posSensitivity" displayName="Position sensitivity" min="0.0" max="1.0" default="0.2" xsi:type="DoubleAttributeDeclarationType">
                <Description><p xmlns="http://www.w3.org/1999/xhtml">Position sensitivity factor</p></Description>
            </Attribute>
            <Attribute name="rotSensitivity" displayName="Orientation sensitivity" min="0.0" max="1.0" default="0.01" xsi:type="DoubleAttributeDeclarationType">
                <Description><p xmlns="http://www.w3.org/1999/xhtml">Orientation sensitivity factor</p></Description>
            </Attribute>
            <Attribute name="axisMapping" displayName="Axis mapping" default="frame" xsi:type="EnumAttributeDeclarationType">
                <Description><p xmlns="http://www.w3.org/1999/xhtml">Specifies how the SpaceNavigator coordinate frame is mapped to the resuling pose</p></Description>
                <EnumValue name="default" displayName="No axis mapping"/>
                <EnumValue name="frame" displayName="Ubitrack frame"/>
                <EnumValue name="worldCam" displayName="World frame observer"/>
            </Attribute>
            <Attribute name="suppressMinorMovements" displayName="Supress minor movements" default="false" xsi:type="EnumAttributeDeclarationType">
                <Description><p xmlns="http://www.w3.org/1999/xhtml">Specifies whether minor movements influence the resuling pose or only the highest one.</p></Description>
                <EnumValue name="false" displayName="False"/>
                <EnumValue name="true" displayName="True"/>
            </Attribute>
            <Attribute name="enableReset" displayName="Enable reset to initial pose" default="true" xsi:type="EnumAttributeDeclarationType">
                <Description><p xmlns="http://www.w3.org/1999/xhtml">Specifies whether the right SpaceNavigator button resets to the initial pose.</p></Description>
                <EnumValue name="false" displayName="False"/>
                <EnumValue name="true" displayName="True"/>
            </Attribute>
            <Attribute name="button" xsi:type="StringAttributeReferenceType"/>            
        </DataflowConfiguration>
    </Pattern>
    
    <!-- Attribute declarations -->
	
    <GlobalNodeAttributeDeclarations>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/1/1)"/>
    </GlobalNodeAttributeDeclarations>
    
    <GlobalEdgeAttributeDeclarations>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/1)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/2)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/3)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/4)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/5)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/6)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/7)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/8)"/>
    </GlobalEdgeAttributeDeclarations> 
    
    <GlobalDataflowAttributeDeclarations>
        <!-- Unfortunately, the xpointer used in Xinclude is currently restricted to the element scheme and absolute element indices in Xerces (and thus XMLBeans) -->
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/3/1)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/3/2)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/3/3)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/3/4)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/3/5)"/>        
    </GlobalDataflowAttributeDeclarations>
    
</UTQLPatternTemplates>

