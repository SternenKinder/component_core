<?xml version="1.0" encoding="UTF-8"?>

<UTQLPatternTemplates xmlns='http://ar.in.tum.de/ubitrack/utql'
                      xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
                      xmlns:xi='http://www.w3.org/2001/XInclude'
                      xmlns:h="http://www.w3.org/1999/xhtml"
                      xsi:schemaLocation='http://ar.in.tum.de/ubitrack/utql ../../../schema/utql_templates.xsd'>
    
    <Pattern name="NDIOptotrakTool" displayName="NDI Optotrak Tool Tracker (Pose)">
        <Description><p xmlns="http://www.w3.org/1999/xhtml">The NDI Optotrak tracker pattern for tools (rom)</p></Description>
        <Output>
            <Node name="Ndi" displayName="NDI Optotrak Tracker">
                <Description><p xmlns="http://www.w3.org/1999/xhtml">NDI Optotrak Tracker</p></Description>
              <Attribute name="freq" displayName="Marker Frequency" default="4500" xsi:type="IntAttributeDeclarationType">
              </Attribute>
			  <Attribute name="fps" displayName="Tracking Frequency" default="25" xsi:type="IntAttributeDeclarationType">
              </Attribute>
			  <Attribute name="initialize" displayName="ReInitialize NDI" min="0" max="1" default="1" xsi:type="IntAttributeDeclarationType">
              </Attribute>
			  <Attribute name="voltage" displayName="LED Voltage" min="0" max="10.5" default="10.5" xsi:type="DoubleAttributeDeclarationType">
              </Attribute>
			  <Attribute name="dutycycle" displayName="LED Duty Cycle" min="0" max="1" default="0.7" xsi:type="DoubleAttributeDeclarationType">
              </Attribute>			  
			  </Node>
            <Node name="Body" displayName="NDI Optotrak Marker">
                <Description><p xmlns="http://www.w3.org/1999/xhtml">NDI Optotrak Marker</p></Description>
            </Node>
            <Edge name="NdiToTarget" displayName="Tracked Transformation" source="Ndi" destination="Body">
                <Attribute name="type" value="6D" xsi:type="EnumAttributeReferenceType"/>
                <Attribute name="mode" value="push" xsi:type="EnumAttributeReferenceType"/>
                <Attribute name="toolname" displayName="Tool Name" xsi:type="StringAttributeDeclarationType">
                    <Description><h:p>Name of the tool tracked.</h:p></Description>
                </Attribute>
            </Edge>
        </Output>
        <DataflowConfiguration>
            <UbitrackLib class="NDIOptotrakToolDriver"/>
        </DataflowConfiguration>
    </Pattern>
    
    <!-- This pattern is bullshit! Should be refactored in Ubitrack so that only the 3DOutput edge remains. At the moment
    the ArtToTarget edge is needed only to set the artType attribute to the 3dcloud value.-->
    <!--Pattern name="Art3D" displayName="A.R.T. Tracker (3D Position List)">
        <Description><p xmlns="http://www.w3.org/1999/xhtml">Logs 3D positions of all marker balls detected by ART</p></Description>
        <Output>
            <Node name="Art" displayName="A.R.T. Tracker">
                <Description><p xmlns="http://www.w3.org/1999/xhtml">A.R.T. Tracker</p></Description>
                <Attribute name="artPort" xsi:type="IntAttributeReferenceType"/>
            </Node>
            <Node name="Body" displayName="A.R.T. Marker">
                <Description><p xmlns="http://www.w3.org/1999/xhtml">A.R.T. Tracker</p></Description>
            </Node>
            <Edge name="ArtToTarget" displayName="Tracked Transformation" source="Art" destination="Body">
                <Attribute name="type" value="6D" xsi:type="EnumAttributeReferenceType"/>
                <Attribute name="mode" value="push" xsi:type="EnumAttributeReferenceType"/>
                <Attribute name="artBodyId" displayName="A.R.T. body ID" min="1" max="20" default="1" xsi:type="IntAttributeDeclarationType">
                    <Description><p xmlns="http://www.w3.org/1999/xhtml">Body ID used by A.R.T. (configured in DTrack software)</p></Description>
                </Attribute>
                <Attribute name="artType" displayName="A.R.T. marker type" default="3dcloud" xsi:type="EnumAttributeDeclarationType">
                    <EnumValue name="3dcloud" displayName="3D point cloud"/>
                </Attribute>
            </Edge>
            <Edge name="3DOutput" displayName="Position list" source="Art" destination="Body">
                <Attribute name="type" value="3DPositionList" xsi:type="EnumAttributeReferenceType"/>
                <Attribute name="mode" value="push" xsi:type="EnumAttributeReferenceType"/>
            </Edge>
        </Output>
        <DataflowConfiguration>
            <UbitrackLib class="ArtTracker"/>
        </DataflowConfiguration>
    </Pattern-->

    
    
    
    <!-- Attribute declarations -->
    
    <GlobalNodeAttributeDeclarations>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/1/1)"/>
    </GlobalNodeAttributeDeclarations>
    
    <GlobalEdgeAttributeDeclarations>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/1)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/2)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/3)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/4)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/5)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/6)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/7)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/8)"/>
    </GlobalEdgeAttributeDeclarations> 

    <GlobalDataflowAttributeDeclarations>
        <!-- Unfortunately, the xpointer used in Xinclude is currently restricted to the element scheme and absolute element indices in Xerces (and thus XMLBeans) -->
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/3/1)"/>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/3/2)"/>
    </GlobalDataflowAttributeDeclarations>
    
</UTQLPatternTemplates>
